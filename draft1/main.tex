%File: anonymous-submission-latex-2024.tex
\documentclass[letterpaper]{article} % DO NOT CHANGE THIS
\usepackage[submission]{aaai24}  % DO NOT CHANGE THIS
\usepackage{times}  % DO NOT CHANGE THIS
\usepackage{helvet}  % DO NOT CHANGE THIS
\usepackage{courier}  % DO NOT CHANGE THIS
\usepackage[hyphens]{url}  % DO NOT CHANGE THIS
\usepackage{graphicx} % DO NOT CHANGE THIS
\urlstyle{rm} % DO NOT CHANGE THIS
\def\UrlFont{\rm}  % DO NOT CHANGE THIS
\usepackage{natbib}  % DO NOT CHANGE THIS AND DO NOT ADD ANY OPTIONS TO IT
\usepackage{caption} % DO NOT CHANGE THIS AND DO NOT ADD ANY OPTIONS TO IT
\frenchspacing  % DO NOT CHANGE THIS
\setlength{\pdfpagewidth}{8.5in} % DO NOT CHANGE THIS
\setlength{\pdfpageheight}{11in} % DO NOT CHANGE THIS
%
% These are recommended to typeset algorithms but not required. See the subsubsection on algorithms. Remove them if you don't have algorithms in your paper.
\usepackage{algorithm}
\usepackage{algorithmic}

% Custom packages
\usepackage{tikz}
\usepackage[inline]{enumitem}

%
% These are are recommended to typeset listings but not required. See the subsubsection on listing. Remove this block if you don't have listings in your paper.
\usepackage{newfloat}
\usepackage{listings}
\DeclareCaptionStyle{ruled}{labelfont=normalfont,labelsep=colon,strut=off} % DO NOT CHANGE THIS
\lstset{%
	basicstyle={\footnotesize\ttfamily},% footnotesize acceptable for monospace
	numbers=left,numberstyle=\footnotesize,xleftmargin=2em,% show line numbers, remove this entire line if you don't want the numbers.
	aboveskip=0pt,belowskip=0pt,%
	showstringspaces=false,tabsize=2,breaklines=true}
\floatstyle{ruled}
\newfloat{listing}{tb}{lst}{}
\floatname{listing}{Listing}
%
% Keep the \pdfinfo as shown here. There's no need
% for you to add the /Title and /Author tags.
\pdfinfo{
/TemplateVersion (2024.1)
}

% DISALLOWED PACKAGES
% \usepackage{authblk} -- This package is specifically forbidden
% \usepackage{balance} -- This package is specifically forbidden
% \usepackage{color (if used in text)
% \usepackage{CJK} -- This package is specifically forbidden
% \usepackage{float} -- This package is specifically forbidden
% \usepackage{flushend} -- This package is specifically forbidden
% \usepackage{fontenc} -- This package is specifically forbidden
% \usepackage{fullpage} -- This package is specifically forbidden
% \usepackage{geometry} -- This package is specifically forbidden
% \usepackage{grffile} -- This package is specifically forbidden
% \usepackage{hyperref} -- This package is specifically forbidden
% \usepackage{navigator} -- This package is specifically forbidden
% (or any other package that embeds links such as navigator or hyperref)
% \indentfirst} -- This package is specifically forbidden
% \layout} -- This package is specifically forbidden
% \multicol} -- This package is specifically forbidden
% \nameref} -- This package is specifically forbidden
% \usepackage{savetrees} -- This package is specifically forbidden
% \usepackage{setspace} -- This package is specifically forbidden
% \usepackage{stfloats} -- This package is specifically forbidden
% \usepackage{tabu} -- This package is specifically forbidden
% \usepackage{titlesec} -- This package is specifically forbidden
% \usepackage{tocbibind} -- This package is specifically forbidden
% \usepackage{ulem} -- This package is specifically forbidden
% \usepackage{wrapfig} -- This package is specifically forbidden
% DISALLOWED COMMANDS
% \nocopyright -- Your paper will not be published if you use this command
% \addtolength -- This command may not be used
% \balance -- This command may not be used
% \baselinestretch -- Your paper will not be published if you use this command
% \clearpage -- No page breaks of any kind may be used for the final version of your paper
% \columnsep -- This command may not be used
% \newpage -- No page breaks of any kind may be used for the final version of your paper
% \pagebreak -- No page breaks of any kind may be used for the final version of your paperr
% \pagestyle -- This command may not be used
% \tiny -- This is not an acceptable font size.
% \vspace{- -- No negative value may be used in proximity of a caption, figure, table, section, subsection, subsubsection, or reference
% \vskip{- -- No negative value may be used to alter spacing above or below a caption, figure, table, section, subsection, subsubsection, or reference

\setcounter{secnumdepth}{0} %May be changed to 1 or 2 if section numbers are desired.

% The file aaai24.sty is the style file for AAAI Press
% proceedings, working notes, and technical reports.
%

% Title

% Your title must be in mixed case, not sentence case.
% That means all verbs (including short verbs like be, is, using,and go),
% nouns, adverbs, adjectives should be capitalized, including both words in hyphenated terms, while
% articles, conjunctions, and prepositions are lower case unless they
% directly follow a colon or long dash
\title{FedKit---Cross-Platform On-Smartphone Federated Learning}
\author{}
\affiliations{}

\begin{document}

\maketitle

\begin{abstract}
    TODO
\end{abstract}

\section{Introduction}

% TODO: Come back after finishing Conclusion.

\section{System Description}

FedKit is a sophisticated client-server FL system that leverages a robust Backend as the server, complemented by \textit{cross-platform smartphones} as clients.
% TODO: Figure of system structure.
The clients perform local training on private on-mobile data and collaboratively contribute to the training of the global model under the Backend's supervision.
Despite the system's apparent simplicity and elegance, implementing a mobile-based FL system introduces specific challenges due to the intricacies of cross-platform mobile development.
To address these challenges, we propose FedKit to support cross-platform on-smartphone FL that emphasizes two key aspects that distinguish it from existing solutions:
\begin{enumerate*}[label=\arabic*)]
    \item cross-smartphone-platform FL support using
        native smartphone ML frameworks, and
    \item flexible FL customization in production enabled by
        our custom FL workflow
\end{enumerate*}.

\subsection{Cross-Smartphone-Platform FL}
FedKit enables federating learning ML models on smartphones
with different operating systems.
For the same ML model developed in Python on a desktop computer,
we can train it on both Android and iOS smartphones,
and aggregate its parameters across these platforms.
This is significant because it
\begin{enumerate*}[label=\arabic*)]
    \item allows FL academic research that tests FL algorithms
        on data across smartphone platforms under real-world circumstances, and
    \item enables the industry to use the massive amount of data on smartphones
        for FL
\end{enumerate*}.
However, popular FL frameworks generally do not support
cross-smartphone-platform FL.
% TODO: Chart of FL frameworks' platform support.
The main difficulty is to interface
Python-incompatible environments with different operating systems and
ML frameworks.
We discuss how we overcome these difficulties next.

We achieve cross-smartphone-platform FL by bridging between
desktop ML and native smartphone ML in three steps:
\begin{enumerate*}[label=\arabic*.]
    \item convert the ML models from desktop ML frameworks (e.g. TensorFlow)
        into formats natively supported by each smartphone platform,
    \item build an unified interface to run the converted models on smartphones
        using native ML frameworks, and
    \item aggregate model parameters across platforms using an unified format
\end{enumerate*}.
% TODO: Figure of ML model conversion.
The native ML frameworks are Google's TensorFlow Lite (TFLite) on Android and
Apple's Core ML on iOS.
We find them to be way superior to othe frameworks because
they best leverage the GPUs and NPUs to accelerate training on
these resource-constraint smartphones.
But, they impose difficulties at different stages.
TFLite model definitions are excessively open-ended,
so we standardize four methods to read and update parameters,
train and infer, and
provide a Python converter to generate standardized TFLite models from
any TensorFlow models.
Running TFLite on smartphones is straightforward using their interpreter.
In contrast, Core ML models have defined forms and an official Python converter,
but Apple artificially restricts on-smartphone training.
To work around Apple's restrictions,
we manually read and update Core ML models' underlying ProtoBuf representations
to update their parameters and configure the training data.
In the end, we have unified native training APIs on both Android and iOS.
More importantly, our APIs yield model parameters in the same
representation---each neural network layer's weights or biases are represented
as a byte array, and
the order of these layers are the same across platforms.
When the Backend receives model parameters,
it can aggregate them without any knowledge of
the implementations of the clients.
This enables us to aggregate parameters from different platforms.
Cross-smartphone-platform aggregation,
together with cross-smartphone-platform training and model conversion,
allows true cross-smartphone-platform FL.

\subsection{Flexible In-Production FL Customization}
\newcommand{\model}{$M$}
\newcommand{\fs}{$S_\mathrm F$}
We provide the flexibility to customize ML models and FL algorithms
in production.
This is crucial because, to iterate on ML models and explore new FL algorithms,
researchers must have the ability to change them.
However, customizing on-smartphone FL in production is difficult because
we cannot modify the client apps without an app update,
which suffers from app stores' slow review processes and
users' slow reaction to update their apps.
Most FL frameworks simply ignore this problem and
hard-code the ML models into the app.
Instead, we shift responsibilities to the Backend in our FL workflow,
utilizing our full control over the Backend to
maximize the potential of FL customization,
which we detail next.

Our FL workflow provides extra flexibility in FL customization in production by
shifting as many responsibilities to the Backend as possible.
First, we can deploy new ML models from the Backend because
it is responsible to decide which model to train.
% TODO: Figure of structure with workflow, numbered.
As shown in Fig. , % TODO: ref
clients start by requesting the Backend for an ML model \model{} that fits
their platform and the kind of training data they have.
They then initiate the training by requesting the Backend for
an FL Server \fs{} for \model{}
(Fig. ). % TODO: ref
FL Server \fs{} is a Python subprocesses of the Backend and
utilizes the Flower FL Framework to
schedule training and evaluation in the FL process.
Here, the Backend is responsible to track different FL sessions and
decide whether
to spawn new FL Servers or let new clients join existing ones.
This design isolates each FL session,
so we can federate learning multiple models simultaneously, and
users would be able to customize the FL process for each model.
We chose Python, Django, and Flower to implement the Backend so that
FL researchers can customize it using the language they are familiar with.
By simply uploading new ML models and
changing the FL algorithm code in Python,
researchers can flexibly customize the FL process in production.


\section{Conclusion and Future Work}


\appendix

\section*{Acknowledgments}
TODO

\bigskip

\bibliography{main}

\end{document}
